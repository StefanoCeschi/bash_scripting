# Guida Completa al Comando `sed`

[ğŸ  Home page](./../readme.md)

## Cos'Ã¨ sed?
`sed` (Stream EDitor) Ã¨ un potente editor di testo Unix che elabora file o stream di testo riga per riga in modo non interattivo. A differenza di editor come `vim` o `nano`, sed legge il testo, applica le trasformazioni specificate e produce il risultato, tutto automaticamente. Ãˆ ideale per sostituzioni, filtraggio e trasformazioni di testo in script e pipeline.

---

## Sintassi Base
```bash
sed [opzioni] 'comando' file
sed [opzioni] -e 'comando1' -e 'comando2' file
```

**Comportamento predefinito:** sed stampa tutte le righe a stdout (anche quelle non modificate)

---

## Indirizzi (Selezionare le Righe)

Gli indirizzi specificano quali righe elaborare:

### Indirizzi Numerici
- `N` â†’ Solo la riga N (es: `3` = terza riga)
- `N,M` â†’ Dalla riga N alla M (es: `2,5` = righe 2, 3, 4, 5)
- `N,+M` â†’ Riga N e le M successive (es: `3,+2` = righe 3, 4, 5)
- `N~S` â†’ Ogni S righe partendo da N (es: `1~2` = righe dispari: 1, 3, 5...)
- `$` â†’ Ultima riga del file

**Esempi:**
```bash
sed '3d' file.txt              # Elimina la terza riga
sed '2,5d' file.txt            # Elimina righe dalla 2 alla 5
sed '$d' file.txt              # Elimina l'ultima riga
```

### Indirizzi con Espressioni Regolari
- `/regex/` â†’ Righe che corrispondono alla regex
- `/regex1/,/regex2/` â†’ Da quando trova regex1 fino a regex2
- `/regex/,N` â†’ Da regex fino alla riga N
- `N,/regex/` â†’ Dalla riga N fino a regex
- `/regex/,+N` â†’ Riga con regex e le N successive

**Esempi:**
```bash
sed '/error/d' log.txt                    # Elimina righe contenenti "error"
sed '/START/,/END/d' file.txt            # Elimina blocco tra START e END
sed '/TODO/,+2d' code.txt                # Elimina riga con TODO e 2 successive
```

### Negazione
- `!` â†’ Inverte la selezione (applica a righe che NON corrispondono)

**Esempi:**
```bash
sed '/^#/!d' file.txt          # Mantiene SOLO le righe che iniziano con #
sed '1,10!d' file.txt          # Mantiene SOLO le righe da 1 a 10
```

---

## Comandi Principali

### Sostituzione: `s`
Il comando piÃ¹ usato. Sintassi: `s/pattern/sostituzione/flag`

**Flag disponibili:**
- `g` â†’ Sostituisce tutte le occorrenze nella riga (non solo la prima)
- `I` o `i` â†’ Case-insensitive
- `N` â†’ Sostituisce solo la N-esima occorrenza (es: `2` = seconda)
- `p` â†’ Stampa le righe modificate
- `w file` â†’ Scrive le righe modificate in un file

**Esempi:**
```bash
sed 's/foo/bar/' file.txt              # Sostituisce prima occorrenza per riga
sed 's/foo/bar/g' file.txt             # Sostituisce tutte le occorrenze
sed 's/foo/bar/2' file.txt             # Sostituisce solo la seconda occorrenza
sed 's/foo/bar/gI' file.txt            # Case-insensitive, tutte le occorrenze
sed 's/^/>> /' file.txt                # Aggiunge ">> " all'inizio di ogni riga
sed 's/$/;/' file.txt                  # Aggiunge ";" alla fine di ogni riga
```

**Riferimenti retroattivi (backreferences):**
```bash
sed 's/\([0-9]\+\)/[\1]/' file.txt     # Racchiude numeri tra parentesi
sed -E 's/([a-z]+)/\U\1/' file.txt     # Converte in maiuscolo (con -E)
```

### Cancellazione: `d`
Elimina le righe selezionate

```bash
sed '5d' file.txt                      # Elimina riga 5
sed '/^$/d' file.txt                   # Elimina righe vuote
sed '/^#/d' file.txt                   # Elimina commenti che iniziano con #
```

### Stampa: `p`
Stampa le righe (usato con `-n` per stampare solo righe specifiche)

```bash
sed -n '10p' file.txt                  # Stampa solo la riga 10
sed -n '5,10p' file.txt                # Stampa righe da 5 a 10
sed -n '/error/p' file.txt             # Stampa solo righe con "error"
```

### Inserimento: `i` e Aggiunta: `a`
- `i\testo` â†’ Inserisce testo PRIMA della riga
- `a\testo` â†’ Aggiunge testo DOPO la riga

```bash
sed '3i\Nuova riga' file.txt           # Inserisce prima della riga 3
sed '5a\Testo aggiunto' file.txt       # Aggiunge dopo la riga 5
sed '/pattern/i\Header' file.txt       # Inserisce prima di ogni riga con pattern
```

### Modifica: `c`
Sostituisce l'intera riga con nuovo testo

```bash
sed '3c\Riga completamente nuova' file.txt
sed '/TODO/c\DONE' file.txt            # Sostituisce righe con TODO
```

### Translitterazione: `y`
Sostituisce caratteri uno-a-uno (come il comando `tr`)

```bash
sed 'y/abc/ABC/' file.txt              # aâ†’A, bâ†’B, câ†’C
sed 'y/aeiou/AEIOU/' file.txt          # Vocali minuscole â†’ maiuscole
```

### Stampa con Caratteri Speciali: `l`
Mostra caratteri non stampabili (tab, newline, etc.)

```bash
sed -n 'l' file.txt                    # Mostra caratteri nascosti
```

---

## Opzioni Comuni

- `-n` â†’ Sopprime output automatico (stampa solo con `p`)
- `-e` â†’ Specifica piÃ¹ comandi
- `-i` â†’ Modifica il file in-place (ATTENZIONE: modifica permanente!)
- `-i.bak` â†’ Crea backup prima di modificare
- `-E` o `-r` â†’ Usa Extended Regular Expressions (ERE)
- `-f script.sed` â†’ Legge comandi da file

**Esempi:**
```bash
sed -n '/error/p' log.txt                      # Stampa solo righe con error
sed -i 's/foo/bar/g' file.txt                  # Modifica file direttamente
sed -i.backup 's/foo/bar/g' file.txt           # Crea file.txt.backup
sed -e 's/foo/bar/' -e 's/baz/qux/' file.txt   # Multipli comandi
sed -E 's/([0-9]+)/[\1]/' file.txt             # Extended regex
```

---

## Esempi Pratici

### Rimuovere commenti e righe vuote
```bash
sed '/^#/d; /^$/d' file.txt
```

### Stampare righe tra due pattern
```bash
sed -n '/START/,/END/p' file.txt
```

### Sostituire solo nella prima riga
```bash
sed '1s/old/new/' file.txt
```

### Aggiungere numerazione alle righe
```bash
sed = file.txt | sed 'N;s/\n/\t/'
```

### Rimuovere spazi all'inizio e fine riga
```bash
sed 's/^[[:space:]]*//; s/[[:space:]]*$//' file.txt
```

### Sostituire solo se la riga contiene un pattern
```bash
sed '/pattern/s/foo/bar/g' file.txt
```

### Estrarre indirizzi email
```bash
sed -n 's/.*\([a-zA-Z0-9._-]*@[a-zA-Z0-9._-]*\).*/\1/p' file.txt
```

---

## Differenza tra BRE e ERE

**BRE (Basic Regular Expressions)** - default di sed:
- Metacaratteri `+ ? | () {}` devono essere escaped: `\+ \? \| \( \) \{ \}`

**ERE (Extended Regular Expressions)** - con `-E` o `-r`:
- Metacaratteri funzionano senza escape: `+ ? | () {}`

```bash
# BRE (default)
sed 's/[0-9]\+/NUM/g' file.txt

# ERE (piÃ¹ leggibile)
sed -E 's/[0-9]+/NUM/g' file.txt
```

---

## Note Importanti

1. **sed non modifica il file originale** a meno che non usi `-i`
2. **Reindirizza l'output** per salvare: `sed 's/foo/bar/' file.txt > nuovo.txt`
3. **Testa sempre prima** di usare `-i`: rimuovi l'opzione e controlla l'output
4. **Usa delimitatori alternativi** per path: `sed 's|/old/path|/new/path|'`
5. **Combina con pipeline**: `cat file | sed 's/foo/bar/' | grep bar`

---

## Risorse Utili

- `man sed` â†’ Manuale completo
- `info sed` â†’ Documentazione dettagliata
- Test online: sed.js.org per sperimentare

[ğŸ  Home page](./../readme.md)